// Local variables
def dockerfile_src_path = 'src' + File.separator + 'main' + File.separator + 'docker'
def dockerfile_dest_path = 'build' + File.separator + 'docker'
def tag = 'productmasterapp'
def tagVersion = 'latest'

// Docker configurations
task copyDockerDependencyFiles(dependsOn: build){
	doFirst {
		copy {
		  from war
		  into dockerfile_dest_path
		}
		copy {
		  from dockerfile_src_path
		  into dockerfile_dest_path
		  //exclude '**/*.yml'
		}
	}
}

// Tag name needs to be provided dynamically once the name is certified
task buildDockerImage (type: Exec) {
		dependsOn copyDockerDependencyFiles
		commandLine "docker", "build", "-t", "${tag}:${tagVersion}", "--build-arg", "BUILD_VERSION=${project.version}", dockerfile_dest_path
}

task startContainer (type: Exec) {
		dependsOn buildDockerImage
		//commandLine "docker", "run", "-p", "8080:8080", "-t", "${tag}:${tagVersion}"
		commandLine "docker-compose", "-f", "${dockerfile_dest_path}"+ File.separator +"docker-compose.yml", "up"
}

task stopContainer (type: Exec) {
	commandLine "docker-compose", "-f", "${dockerfile_dest_path}"+ File.separator +"docker-compose.yml", "stop"
}
